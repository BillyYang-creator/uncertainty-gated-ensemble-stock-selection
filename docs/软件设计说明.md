# 软件设计说明

## 1. 软件名称
AI量化选股与调仓系统 V1.0

## 2. 开发者
个人独立开发者

## 3. 目标与范围

本软件用于股票池因子数据处理、模型推理与选股结果输出。系统支持：
- 本地独立运行（命令行模式）
- 聚宽策略环境迁移（模板脚本）

## 4. 总体架构

系统采用分层结构：
- 配置层：路径与模型文件配置
- 数据层：因子列表加载与特征数据对齐
- 模型层：三模型统一推理接口
- 策略层：截面归一化、融合打分、一致性评估、TopN 选股
- 接口层：CLI 本地入口、聚宽模板入口

## 5. 功能模块设计

### 5.1 配置模块 (`src/quant_soft/config.py`)
- 统一管理模型路径、因子文件路径
- 保证不同运行入口使用同一配置来源

### 5.2 特征处理模块 (`src/quant_soft/feature_io.py`)
- 读取因子清单
- 校验输入特征列完整性
- 按因子顺序输出模型输入矩阵

### 5.3 模型服务模块 (`src/quant_soft/model_service.py`)
- 加载三类模型文件
- 兼容 `predict_proba` 与 `predict`
- 输出统一二维预测矩阵 `(n, 3)`

### 5.4 评分模块 (`src/quant_soft/scoring.py`)
- 对三路预测做截面 rank 归一化
- 计算综合分数 `ai_score`
- 计算一致性指标 `consistency`
- 输出排序结果并支持 TopN 截取

### 5.5 入口模块 (`src/quant_soft/cli.py`, `main.py`)
- `inspect-models`：模型健康检查
- `rank`：输入因子特征，输出选股结果 CSV

## 6. 数据与文件约束

- 因子文件：`selected_factors.csv`，字段名 `factor`
- 特征文件：必须含 `code` 列 + 全量因子列
- 模型文件：`model_reg_final.pkl`、`model_cls_final.pkl`、`model_dir_final.pkl`

## 7. 异常处理

- 因子缺失：抛出缺失列错误
- 文件不存在：由 Python IO 异常提示
- 模型接口不一致：在推理阶段统一封装

## 8. 可扩展性设计

- 可新增风险控制模块与交易执行模块
- 可扩展为 API 服务或可视化前端
- 可替换模型而不改变上层流程
