# 用户手册

## 1. 软件简介

AI量化选股与调仓系统 V1.0 用于基于多模型输出进行股票打分和选股，支持本地离线运行与聚宽迁移部署。

## 2. 运行环境

- Windows 10/11
- Python 3.10 及以上

## 3. 安装步骤

```bash
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

## 4. 文件准备

确保以下文件位于项目根目录：
- `model_reg_final.pkl`
- `model_cls_final.pkl`
- `model_dir_final.pkl`
- `selected_factors.csv`

执行 `rank` 命令时，用户还需准备输入特征文件，例如 `features_2026-02-15.csv`。

特征文件要求：
- 含 `code` 列
- 含全部因子列（名称与 `selected_factors.csv` 一致）

示例数据说明：
- 示例训练数据文件：`data/train.csv`
- 该文件可用于训练/分析，但当前不含 `code` 列，不能直接用于 `rank`
- 如需用于 `rank`，需由用户补充 `code` 列

## 5. 命令说明

### 5.1 模型检查

```bash
python main.py inspect-models --root .
```

输出内容包括：
- 因子数量
- 预测矩阵维度
- 预测值统计信息

### 5.2 选股排名

```bash
python main.py rank --root . --features your_features.csv --top-n 10 --out rank_result.csv
```

参数说明：
- `--features`：输入特征 CSV（必填）
- `--top-n`：输出股票数量
- `--out`：结果文件路径

## 6. 输出说明

`rank_result.csv` 主要字段：
- `pred_reg`：回归模型输出
- `pred_cls`：分类模型输出
- `pred_dir`：方向模型输出
- `ai_score`：综合评分
- `consistency`：一致性指标（越小代表三模型分歧越小）

## 7. 聚宽使用

1. 打开 `joinquant_strategy_template.py`
2. 粘贴到聚宽策略编辑器
3. 上传模型与因子文件
4. 启动回测

## 8. 常见问题

1. 报错 `No module named lightgbm`  
安装依赖：`pip install -r requirements.txt`

2. 报错缺失因子列  
检查输入特征文件是否包含全部因子列且名称一致
