# 三模型与一致性指标说明（GitHub 发布版）

## 1. 模型类型与输出尺度

| 文件 | 类型 | objective | 输出特征 |
|---|---|---|---|
| `model_reg_final.pkl` | LightGBM `Booster` | regression | 连续值，无固定边界 |
| `model_cls_final.pkl` | LightGBM `Booster` | binary | 概率值，约在 `[0,1]` |
| `model_dir_final.pkl` | LightGBM `Booster` | binary | 概率值，约在 `[0,1]` |

结论：三模型输出尺度天然不一致，直接混用会产生尺度偏置。

## 2. 为什么不改模型本体

当前方案不在策略侧重训模型，而是保持预训练模型固定，在策略中做融合和阈值控制。主要原因：

- 聚宽策略环境更适合推理，不适合重训练
- 固定模型有利于回测口径一致和可复现
- 工程复杂度更低，稳定性更高

## 3. 融合与一致性口径

- 融合分数 `ai_score`：三路预测先做截面 `rank` 归一化，再取平均
- 一致性 `consistency`：当前实现使用三路原始预测的方差

说明：

- `ai_score` 已消除输出量纲差异，适合做跨模型融合排序
- `consistency` 使用原始方差在实证上有效，但存在尺度敏感性

建议在研报中补充一个替代定义做稳健性对照：

- 先对三路输出都做 `rank-scale`
- 再计算方差作为 `consistency_alt`
- 对比两种定义下的回测指标

## 4. 因子数量与顺序

- 模型输入是 43 维特征
- `selected_factors.csv` 应包含 43 个因子
- 因子顺序必须与训练时一致

策略中采用分批拉取因子再按原顺序拼接，避免请求过大和顺序错乱。

## 5. 推理接口兼容性

`model_inference()` 优先走 `predict_proba`，否则走 `predict`，可兼容 sklearn 包装模型和 LightGBM 原生 `Booster`。

## 6. 一句话对外口径

模型在回测期内固定，不做滚动训练；策略侧通过动态阈值和一致性指标控制选股强度，融合评分先归一化再排序，以提高不同模型输出尺度下的可比性。
